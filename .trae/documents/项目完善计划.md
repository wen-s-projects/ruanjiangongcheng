# 卡卡项目完善任务清单

## 📋 项目概述
基于对项目的全面检查，发现存在技术栈冲突、功能缺失、测试不足等问题。本任务清单将按照项目宪法要求（前端Vue3、后端Django、数据库MySQL）进行完善。

---

## 🔴 阶段0：技术栈重构（优先级：P0）

### T001：后端技术栈迁移
- **任务**：将现有Node.js/Express后端迁移至Django REST Framework
- **工作内容**：
  - 创建Django项目结构
  - 配置Django settings（数据库、中间件、CORS等）
  - 创建Django apps：users, articles, foods, uploads, auth
  - 迁移Prisma schema至Django models
  - 实现基础API路由结构
- **验收标准**：Django项目可启动，基础路由可访问
- **预计工时**：3天

### T002：前端项目初始化
- **任务**：创建Vue 3前端项目
- **工作内容**：
  - 使用Vite创建Vue 3 + TypeScript项目
  - 配置路由（Vue Router）
  - 配置状态管理（Pinia）
  - 配置UI组件库（Element Plus或Ant Design Vue）
  - 配置Axios请求拦截器
  - 创建基础页面布局
- **验收标准**：前端项目可启动，基础路由可访问
- **预计工时**：2天

---

## 🔴 阶段1：基础设施搭建（优先级：P0）

### T003：数据库环境配置
- **任务**：配置MySQL数据库和Django迁移
- **工作内容**：
  - 创建Docker Compose配置（MySQL + Redis + MinIO）
  - 配置Django数据库连接
  - 生成并执行Django migrations
  - 创建数据库种子数据脚本
  - 编写数据库回滚策略文档
- **验收标准**：数据库可正常连接，migrations成功执行
- **预计工时**：1天

### T004：认证授权系统
- **任务**：实现JWT认证和权限管理
- **工作内容**：
  - 实现用户注册API（POST /api/auth/register）
  - 实现用户登录API（POST /api/auth/login）
  - 实现JWT token生成和验证
  - 实现token刷新机制
  - 创建权限装饰器（@login_required, @admin_required）
  - 实现密码加密（bcrypt）
- **验收标准**：用户可注册登录，JWT验证正常工作
- **预计工时**：2天

### T005：日志和监控配置
- **任务**：配置日志系统和错误监控
- **工作内容**：
  - 配置Django日志（结构化JSON格式）
  - 集成Sentry错误监控
  - 配置Prometheus指标暴露
  - 实现请求日志中间件
  - 创建健康检查端点（GET /health）
- **验收标准**：日志正常输出，错误可追踪
- **预计工时**：1天

---

## 🟡 阶段2：用户管理模块（优先级：P1）

### T006：用户基础信息管理
- **任务**：实现用户CRUD和资料管理
- **工作内容**：
  - 实现用户列表API（GET /api/users）
  - 实现用户详情API（GET /api/users/:id）
  - 实现用户更新API（PUT /api/users/:id）
  - 实现用户删除API（DELETE /api/users/:id，软删除）
  - 实现头像上传功能
  - 实现背景图上传功能
  - 实现个人简介编辑
- **验收标准**：用户信息可正常管理
- **预计工时**：2天

### T007：身体数据管理
- **任务**：实现身体数据记录和计算
- **工作内容**：
  - 实现身体数据创建API（POST /api/body-data）
  - 实现身体数据更新API（PUT /api/body-data/:id）
  - 实现BMI计算逻辑
  - 实现基础代谢率（BMR）计算逻辑
  - 实现每日总消耗（TDEE）计算逻辑
  - 添加数据验证（年龄、身高、体重、体脂率范围）
- **验收标准**：身体数据可正常记录和计算
- **预计工时**：2天

---

## 🟡 阶段3：食物记录模块（优先级：P1）

### T008：食物字典管理
- **任务**：实现食物字典CRUD
- **工作内容**：
  - 实现食物列表API（GET /api/foods）
  - 实现食物详情API（GET /api/foods/:id）
  - 实现食物搜索API（GET /api/foods?search=）
  - 实现食物创建API（POST /api/foods，需管理员权限）
  - 实现食物更新API（PUT /api/foods/:id，需管理员权限）
  - 实现食物删除API（DELETE /api/foods/:id，需管理员权限）
- **验收标准**：食物字典可正常管理
- **预计工时**：2天

### T009：食物摄入记录
- **任务**：实现每日食物摄入记录
- **工作内容**：
  - 实现摄入记录创建API（POST /api/food-records）
  - 实现摄入记录列表API（GET /api/food-records）
  - 实现摄入记录更新API（PUT /api/food-records/:id）
  - 实现摄入记录删除API（DELETE /api/food-records/:id）
  - 实现按日期筛选功能
  - 实现按餐次筛选功能（早餐/午餐/晚餐/加餐）
  - 实现每日总热量计算
- **验收标准**：食物摄入可正常记录和查询
- **预计工时**：2天

### T010：AI识图功能
- **任务**：实现食物图片识别
- **工作内容**：
  - 集成AI识别API（GPT-4o-vision）
  - 实现图片上传接口
  - 实现AI识别结果解析
  - 实现自动匹配食物字典
  - 实现未知食物占位符创建
  - 实现识别结果用户确认和编辑
- **验收标准**：可上传图片并识别食物
- **预计工时**：3天

---

## 🟡 阶段4：历史记录和统计（优先级：P1）

### T011：日历历史记录
- **任务**：实现日历视图和历史记录
- **工作内容**：
  - 实现日历数据API（GET /api/calendar?month=）
  - 实现每日记录次数统计
  - 实现日期详情API（GET /api/calendar/:date）
  - 实现月度总热量统计
  - 实现月度冗余/缺口计算
- **验收标准**：日历视图可正常显示历史记录
- **预计工时**：2天

### T012：目标设置和提醒
- **任务**：实现目标管理和达成提醒
- **工作内容**：
  - 实现目标创建API（POST /api/goals）
  - 实现目标更新API（PUT /api/goals/:id）
  - 实现目标查询API（GET /api/goals）
  - 实现目标达成检测逻辑
  - 实现目标达成弹窗提醒
  - 支持体重目标和体脂率目标
- **验收标准**：目标可设置和达成提醒
- **预计工时**：2天

---

## 🟢 阶段5：文章系统（优先级：P2）

### T013：文章CRUD
- **任务**：实现文章发布和管理
- **工作内容**：
  - 实现文章列表API（GET /api/articles）
  - 实现文章详情API（GET /api/articles/:id）
  - 实现文章创建API（POST /api/articles）
  - 实现文章更新API（PUT /api/articles/:id）
  - 实现文章删除API（DELETE /api/articles/:id，软删除）
  - 实现文章状态管理（draft/published）
- **验收标准**：文章可正常发布和管理
- **预计工时**：2天

### T014：标签和评论系统
- **任务**：实现标签分类和评论功能
- **工作内容**：
  - 实现标签创建API（POST /api/tags）
  - 实现标签列表API（GET /api/tags）
  - 实现按标签筛选文章
  - 实现评论创建API（POST /api/articles/:id/comments）
  - 实现评论列表API（GET /api/articles/:id/comments）
  - 实现评论删除API（DELETE /api/comments/:id）
  - 实现评论分页
- **验收标准**：标签和评论功能正常
- **预计工时**：2天

### T015：Markdown渲染
- **任务**：实现Markdown预览和渲染
- **工作内容**：
  - 实现Markdown预览API（POST /api/markdown/preview）
  - 集成remark + rehype + rehype-sanitize
  - 实现XSS防护
  - 实现图片链接处理
- **验收标准**：Markdown可正常渲染且安全
- **预计工时**：1天

---

## 🟢 阶段6：管理员功能（优先级：P2）

### T016：管理员用户管理
- **任务**：实现管理员用户管理功能
- **工作内容**：
  - 实现用户列表API（GET /api/admin/users）
  - 实现用户详情API（GET /api/admin/users/:id）
  - 实现用户删除API（DELETE /api/admin/users/:id）
  - 实现用户名称修改API（PUT /api/admin/users/:id/username）
  - 实现僵尸账号检测和清理
  - 实现用户活跃度统计
- **验收标准**：管理员可管理用户
- **预计工时**：2天

### T017：食物审核流程
- **任务**：实现食物申请审核
- **工作内容**：
  - 实现食物申请列表API（GET /api/admin/food-applications）
  - 实现食物申请详情API（GET /api/admin/food-applications/:id）
  - 实现食物申请批准API（POST /api/admin/food-applications/:id/approve）
  - 实现食物申请拒绝API（POST /api/admin/food-applications/:id/reject）
  - 实现审核后自动更新FoodDict
- **验收标准**：食物申请可正常审核
- **预计工时**：2天

---

## 🔵 阶段7：前端开发（优先级：P1）

### T018：用户界面开发
- **任务**：实现用户端界面
- **工作内容**：
  - 实现登录注册页面
  - 实现个人资料编辑页面
  - 实现身体数据记录页面
  - 实现食物记录页面
  - 实现AI识图页面
  - 实现历史记录日历页面
  - 实现目标设置页面
  - 实现文章列表和详情页面
- **验收标准**：用户端界面完整可用
- **预计工时**：5天

### T019：管理员界面开发
- **任务**：实现管理员端界面
- **工作内容**：
  - 实现用户管理页面
  - 实现食物审核页面
  - 实现食物字典管理页面
  - 实现数据统计页面
- **验收标准**：管理员端界面完整可用
- **预计工时**：3天

### T020：移动端适配
- **任务**：实现移动端响应式设计
- **工作内容**：
  - 实现移动端布局适配
  - 实现移动端交互优化
  - 实现移动端相机调用
  - 实现移动端底部导航
- **验收标准**：移动端体验良好
- **预计工时**：3天

---

## 🔵 阶段8：测试和质量保证（优先级：P1）

### T021：单元测试
- **任务**：编写后端单元测试
- **工作内容**：
  - 用户模型和API测试
  - 食物模型和API测试
  - 文章模型和API测试
  - 认证授权测试
  - 计算逻辑测试（BMI、BMR、TDEE）
- **验收标准**：单元测试覆盖率≥80%
- **预计工时**：3天

### T022：集成测试
- **任务**：编写集成测试
- **工作内容**：
  - 用户注册登录流程测试
  - 食物记录完整流程测试
  - 文章发布流程测试
  - 管理员审核流程测试
- **验收标准**：关键流程测试通过
- **预计工时**：2天

### T023：E2E测试
- **任务**：编写端到端测试
- **工作内容**：
  - 用户完整使用流程测试
  - 管理员完整操作流程测试
  - 跨浏览器测试
- **验收标准**：E2E测试通过
- **预计工时**：2天

### T024：性能测试
- **任务**：进行性能测试和优化
- **工作内容**：
  - 使用k6进行负载测试（100并发）
  - 使用Lighthouse进行首屏渲染测试
  - 数据库查询优化
  - 缓存策略优化
- **验收标准**：P95响应时间<1s，首屏渲染<2s
- **预计工时**：2天

---

## 🔵 阶段9：部署和运维（优先级：P1）

### T025：容器化部署
- **任务**：实现Docker容器化
- **工作内容**：
  - 编写Django Dockerfile
  - 编写Vue Dockerfile
  - 编写docker-compose.yml
  - 配置Nginx反向代理
  - 配置SSL证书
- **验收标准**：可通过docker-compose启动
- **预计工时**：2天

### T026：CI/CD配置
- **任务**：配置持续集成和部署
- **工作内容**：
  - 配置GitHub Actions
  - 配置自动化测试
  - 配置代码质量检查（ESLint、flake8）
  - 配置自动部署
- **验收标准**：PR自动运行测试和检查
- **预计工时**：2天

### T027：监控和告警
- **任务**：配置监控和告警系统
- **工作内容**：
  - 配置Prometheus监控
  - 配置Grafana仪表盘
  - 配置告警规则
  - 配置日志聚合
- **验收标准**：监控数据正常，告警可触发
- **预计工时**：2天

---

## 📊 任务统计
- **总任务数**：27个
- **预计总工时**：约65天（单人）
- **优先级分布**：
  - P0（紧急）：5个任务
  - P1（重要）：16个任务
  - P2（一般）：6个任务

---

## 🎯 里程碑
1. **M1（2周）**：技术栈重构完成，基础设施搭建完成
2. **M2（4周）**：用户和食物模块完成
3. **M3（6周）**：历史记录和文章系统完成
4. **M4（8周）**：前端开发完成
5. **M5（10周）**：测试和部署完成，项目上线